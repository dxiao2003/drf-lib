var errorModule=angular.module("drf-lib.error",["angular.filter"]),errorParser=function(r,e){this.ucfirstFilter=e,this.lowercaseFilter=r};errorParser.$inject=["lowercaseFilter","ucfirstFilter"],errorParser.prototype.extractMessage=function(r){var e=this;if(r.data&&r.data.non_field_errors)return r.data.non_field_errors.join(" ");if(r.data&&r.data.detail)return r.data.detail;if(400==r.status){var t="";for(var n in r.data)t+=e.ucfirstFilter(e.lowercaseFilter(n))+": "+r.data[n]+" ";return t}return r.statusText?e.ucfirstFilter(e.lowercaseFilter(r.statusText)):angular.isString(r)?r:"Service unavailable"},errorModule.service("errorParser",errorParser),angular.module("drf-lib.util",[]).service("restServiceHelper",["drfUtil",function(r){var e=this;e.createListFunction=function(e,t){return function(n){n=r.underscoredProperties(n)||{};var o=e.get(n).$promise;return t||(t=function(r){return r}),o.then(t).then(function(r){if(r.hasOwnProperty("results")){var e=r.results;return angular.isNumber(r.count)&&(e.count=r.count),e}return r})}}}]).service("drfUtil",["$window","$q",function(r,e){function t(r){function e(t){if(angular.isArray(t)){for(var n=t,o=[],a=0;a<n.length;a++)o.push(e(n[a]));return o}if(angular.isObject(t)){var u=t,i={};for(var s in u)u.hasOwnProperty(s)&&0!==s.indexOf("$")&&(angular.isObject(u[s])?i[r(s)]=e(u[s]):i[r(s)]=u[s]);return i}return t}return e}var n=this,o=r.s;n.camelizeProperties=t(o.camelize),n.underscoredProperties=t(o.underscored),n.wrapMethod=function(r,t,n){return function(){t();var o=r.apply(this,arguments);return o&&o.then?o.then(function(r){return n(),r},function(r){return n(),e.reject(r)}):(n(),o)}},n.wrapMethods=function(r,e,t){var o=angular.copy(r);o.wrapped={};for(var a in r)if(angular.isFunction(r[a])){var u=function(e){return function(){return e.apply(r,arguments)}};o.wrapped[a]=n.wrapMethod(u(r[a]),e,t)}return o},n.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var e=16*Math.random()|0,t="x"==r?e:3&e|8;return t.toString(16)})}}]),angular.module("drf-lib.auth.rest",["ngResource","rest-api.url"]).service("authRest",["$http","urlOf","$q","drfUtil",function(r,e,t,n){function o(r){if(200==r.status)return r.data.key;throw r}return this.login=function(t,n){return r.post(e.login,{username:t,password:n}).then(o)},this.externalLogin=function(a,u){return u=n.underscoredProperties(u),e[a+"-login"]?r.post(e[a+"-login"],u).then(o):t.reject({provider:a})},this.logoutEverywhere=function(){return r.post(e.logout)},this}]);var authModule=angular.module("drf-lib.auth.services",["drf-lib.auth.rest","drf-lib.user.rest","drf-lib.error"]).service("authInterceptor",["$injector","urlService","$q",function(r,e,t){return{responseError:function(e){var n=r.get("authService");return 401==e.status&&n.isAuthenticated()&&n.logout(e),t.reject(e)},request:function(t){var n=r.get("authService");return e.domainRequiresAuthorization(t.url)&&n.isAuthenticated()&&(t.headers=t.headers||{},t.headers.Authorization||(t.headers.Authorization=n.authHeader())),t}}}]).config(["$httpProvider",function(r){r.interceptors.push("authInterceptor")}]),authService=function(r,e,t,n,o,a,u,i){var s=this;s.authRest=r,s.$localStorage=e,s.$injector=t,s.$log=n,s.loginCallbacks=u,s.logoutCallbacks=i,s.userRest=o,s.errorParser=a,e.auth&&e.auth.token&&s.setIdentity(e.auth.token,e.auth.username)};authService.prototype.login=function(r,e){var t=this;return t.authRest.login(r,e).then(function(e){return t.setIdentity(e,r),e})},authService.prototype.externalLogin=function(r,e){var t=this;return t.authRest.externalLogin(r,e).then(function(r){return t.setIdentity(r,null),t.userRest.getProfile().then(function(r){return t.$localStorage.auth.username=r.username,r})["catch"](function(r){var e=t.errorParser.extractMessage(r);throw t.$log.error("Could not load user profile: "+e),r})})},authService.prototype.setIdentity=function(r,e){var t=this;t.$localStorage.auth={token:r,username:e};for(var n=0;n<t.loginCallbacks.length;n++){var o=t.loginCallbacks[n];try{t.$injector.invoke(o,null,{token:r,username:e,authService:t})}catch(a){t.$log.error("error running login callback: "+a)}}},authService.prototype.logout=function(r){var e=this;e.$localStorage.auth&&delete e.$localStorage.auth.token,e.$localStorage.username&&delete e.$localStorage.auth.username;for(var t=0;t<e.logoutCallbacks.length;t++){var n=e.logoutCallbacks[t];try{e.$injector.invoke(n,e,{authService:e,response:r})}catch(o){e.$log.error("error running logout callback: "+o)}}},authService.prototype.logoutEverywhere=function(){var r=this;return r.authRest.logoutEverywhere().then(function(e){return r.logout(),e})},authService.prototype.getToken=function(){var r=this;return r.$localStorage.auth?r.$localStorage.auth.token:void 0},authService.prototype.setUsername=function(r){var e=this;if(!e.$localStorage.auth)throw"Not logged in";e.$localStorage.auth.username=r},authService.prototype.getUsername=function(){var r=this;return r.$localStorage.auth?r.$localStorage.auth.username:void 0},authService.prototype.authHeader=function(){var r=this;return"Token "+r.getToken()},authService.prototype.isAuthenticated=function(){var r=this;return r.$localStorage.auth&&!!r.$localStorage.auth.token},authModule.provider("authService",function(){var r=this,e=[],t=[];r.addLoginCallback=function(r){e.push(r)},r.addLogoutCallback=function(r){t.push(r)},r.$get=["authRest","$localStorage","$injector","$log","userRest","errorParser",function(r,n,o,a,u,i){return new authService(r,n,o,a,u,i,e,t)}]}),angular.module("drf-lib.user.rest",["ngResource","rest-api.url"]).service("userRest",["$resource","urlOf","$http","drfUtil",function(r,e,t,n){var o=this,a=function(r){return n.camelizeProperties(r)},u=function(r){return r.data};o.getProfile=function(){var t=r(e["rest-auth-user"]);return t.get().$promise.then(a)},o.setProfile=function(t){t=n.underscoredProperties(t);var o=r(e["rest-auth-user"],void 0,{update:{method:"PUT"}}),u=new o(t);return u.$update().then(a)},o.setPassword=function(r,n){return t.post(e["rest-auth-set-password"],{new_password1:r,new_password2:n}).then(u).then(a)},o.registerUser=function(r,n,o,i){var s={username:r,password1:o,password2:o,email:i};return t.post(e["rest-auth-register"],s).then(u).then(a)},o.resetPassword=function(r){return t.post(e["rest-auth-reset-password"],{email:r}).then(u).then(a)},o.confirmResetPassword=function(r,n,o,i){var s={uid:r,token:n,new_password1:o,new_password2:i};return t.post(e["rest-auth-confirm-reset"],s).then(u).then(a)},o.linkExternalLogin=function(r,o){return o=n.underscoredProperties(o),e[r+"-login"]?t.post(e[r+"-login"]+"?process=connect",o).then(function(r){return r.data}).then(a):$q.reject({provider:r})},o.disconnectExternalLogin=function(t,n){var o=r(e["rest-auth-user-external-login"]);return o.remove({username:t.username,externalLoginId:n}).$promise.then(a)}}]);